{% extends "base.html" %}
{% block content %}

<div class="container-fluid">
    <center><h2>Home!</h2>
    <button type="button" id="refresh" class="btn btn-primary btn-sm">refresh</button>
    </center>
    {% for device in device_list %}
    <div class="row">
        <hr>
        <div class="col-xs-12 col-md-4">
            <button type="button" id="bed1" class="btn btn-block {{ device[2] }}"><h2>{{ device[1] }}</h2></button>
        </div>
        <div class="col-xs-12 col-md-7">
            <button data-toggle="collapse" data-target="#collapse-{{ device[0] }}" type="button" class="btn btn-default btn-lg ">
                <span class="glyphicon glyphicon-hourglass" aria-hidden="true"></span>
            </button>
            <button data-toggle="collapse" data-target="#collapse-{{ device[0] }}b" type="button" class="btn btn-default btn-lg">
                <span class="glyphicon glyphicon-time" aria-hidden="true"></span>
            </button>
            {% for entry in timer %}
                {% if device[0] == entry.name_id %}
                    <div class="timer-entry">
                        <label>on:</label> {{ entry.start_time }}
                        <label>off:</label> {{ entry.end_time  }}
                        <button class="btn-danger btn-delete btn-sm" data-id="{{ entry.id }}">
                            <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
                        </button>
                    </div>
                {% endif %}
            {% endfor %}
                <div id="collapse-{{ device[0] }}" class="panel-collapse collapse">
                    <div class="panel-body">
                        <form>
                        <p>
                          <label for="amount">Timer:</label>
                          <input type="hidden" class="deviceid" value="{{ device[0] }}"/>
                          <span id="slider-step-value-{{ device[0] }}" class="timer-value"></span>
                        </p>
                        <div class="device{{ device[0] }}" id="slider-step-{{ device[0] }}"></div>
                        <br>
                        <button type="button" class="addtimer btn btn-default btn-md btn-success">
                            <span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span>
                        </button>
                        <button data-toggle="collapse" data-target="#collapse-{{ device[0] }}" type="button" class="btn btn-default btn-md btn-danger">
                            <span class="glyphicon glyphicon-remove-sign" aria-hidden="true"></span>
                        </button>
                        </form>
                    </div>
                </div>

                <div id="collapse-{{ device[0] }}b" class="panel-collapse collapse">
                    <div class="panel-body">
                            <form>
                                <input type="hidden" class="deviceid" value="{{ device[0] }}"/>
                                <label>ON:</label>
                                <span class="timer-low-value" id="slider-range-noui-value-start-{{ device[0] }}"></span>
                                <label>OFF:</label>
                                <span  class="timer-high-value" id="slider-range-noui-value-end-{{ device[0] }}"></span>
                        <div id="slider-range-noui-{{ device[0] }}"></div>
                        <br>
                        <button type="button" class="adder btn btn-default btn-md btn-success">
                            <span  class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span>
                        </button>
                        <button data-toggle="collapse" data-target="#collapse-{{ device[0] }}b" type="button" class="btn btn-default btn-md btn-danger">
                            <span class="glyphicon glyphicon-remove-sign" aria-hidden="true"></span>
                        </button>
                        </form>
                    </div>
                </div>
        </div>
    </div>
    <script>
    $("#device-{{ device[0] }}").click(function(){
    $.get("http://{{ device[3] }}/cgi-bin/relay.cgi?toggle",
    function(data){
        if(data='ON'){
            $("#device-{{ device[0] }}").toggleClass("btn-danger btn-success");
          }
    })
});

    function pad(a){
    return a < 10 ? '0'+a : a;
}

function set (value) {
    $(this).html(pad(Math.floor(value/4)) + ":" + pad((value%4)*15));
}

$(function() {
  var slider = $("#slider-step-{{ device[0] }}"), val = $("#slider-step-value-{{ device[0] }}");

  slider.noUiSlider({
      range: { min: 0, max: (12*4) },
      start: 8
  });

  slider.Link().to(val, set, wNumb({ decimals: 0 }));
});

$(function() {
  var sliderrangenoui = $("#slider-range-noui-{{ device[0] }}"),
      valstart = $("#slider-range-noui-value-start-{{ device[0] }}"),
      valend = $("#slider-range-noui-value-end-{{ device[0] }}");

  sliderrangenoui.noUiSlider({
      range: { min: 0, max: (24*4) },
      start: [ 8, 48 ],
  });

  sliderrangenoui.Link('lower').to(valstart, set, wNumb({ decimals: 0 }));
  sliderrangenoui.Link('upper').to(valend, set, wNumb({ decimals: 0 }));

});


    </script>
    {% endfor %}
</div>

{% endblock %}